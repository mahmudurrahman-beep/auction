{% extends "auctions/layout.html" %}
{% load static %}

{% block title %}Home â€¢ Auction{% endblock %}

{% block body %}
<!-- Hero band shown only on home page -->
<section class="hero bg-dark text-light rounded-3 mb-4">
  <div class="container py-5">
    <div class="row align-items-center">
      <div class="col-lg-6">
        <h1 class="display-5 fw-bold">Creative Auctions, Smarter Bidding</h1>
        <p class="lead mb-4">Turn your items into competitive listings. Clean design, instant bids, and curated categories.</p>
        <div class="d-flex gap-2">
          {% if user.is_authenticated %}
            <a class="btn btn-warning btn-lg" href="{% url 'create' %}">Create Listing</a>
          {% else %}
            <a class="btn btn-warning btn-lg" href="{% url 'login' %}?next={% url 'create' %}">Create Listing</a>
          {% endif %}
          <a class="btn btn-outline-light btn-lg" href="{% url 'categories' %}">Browse Categories</a>
        </div>
      </div>

      <div class="col-lg-6 d-none d-lg-block">
        <div id="heroPreviewCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
          <div class="carousel-inner">
            {% for listing in listings|slice:":5" %}
              <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <div class="hero-card p-4 rounded-3 shadow-lg">
                  <div class="card border-0">
                    {% if listing.image_url %}
                      <img src="{{ listing.image_url }}" class="card-img-top rounded" alt="{{ listing.title }}">
                    {% else %}
                      <img src="{% static 'auctions/default.png' %}" class="card-img-top rounded" alt="Preview">
                    {% endif %}
                    <div class="card-body">
                      <h5 class="card-title mb-1">{{ listing.title }}</h5>
                      <p class="card-text text-muted mb-1">
                        {% if listing.category %}{{ listing.category.name }}{% else %}Uncategorized{% endif %}
                      </p>
                      <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">Current</small>
                        <strong>${{ listing.current_price }}</strong>
                      </div>
                      <div class="mt-3">
                        <a class="btn btn-primary btn-sm" href="{% url 'listing' listing.id %}">View Listing</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            {% empty %}
              <div class="carousel-item active">
                <div class="hero-card p-4 rounded-3 shadow-lg">
                  <div class="card border-0">
                    <img src="{% static 'auctions/default.png' %}" class="card-img-top rounded" alt="Preview">
                    <div class="card-body">
                      <h5 class="card-title mb-1">No active listings yet</h5>
                      <p class="card-text text-muted mb-1">Be the first to create one.</p>
                      <a class="btn btn-primary btn-sm" href="{% url 'create' %}">Create Listing</a>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>

          <button class="carousel-control-prev" type="button" data-bs-target="#heroPreviewCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#heroPreviewCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Listings grid -->
<section>
  <h2 class="mb-4">Active Listings</h2>
  <div class="row row-cols-1 row-cols-md-3 g-4">
    {% for listing in listings %}
      <div class="col">
        <div class="card h-100">
          {% if listing.image_url %}
            <img src="{{ listing.image_url }}" class="card-img-top" alt="{{ listing.title }}">
          {% else %}
            <img src="{% static 'auctions/default.png' %}" class="card-img-top" alt="No image available">
          {% endif %}
          <div class="card-body">
            <h5 class="card-title">{{ listing.title }}</h5>
            <p class="card-text">{{ listing.description|striptags|truncatewords:20|linebreaks }}</p>
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item"><strong>Starting Bid:</strong> ${{ listing.starting_bid }}</li>
            <li class="list-group-item"><strong>Current Price:</strong> ${{ listing.current_price }}</li>
            <li class="list-group-item"><strong>Category:</strong>
              {% if listing.category %}{{ listing.category.name }}{% else %}No Category{% endif %}
            </li>
          </ul>
          <div class="card-footer text-center">
            <a href="{% url 'listing' listing.id %}" class="btn btn-primary btn-sm">View Listing</a>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12">
        <div class="alert alert-info">No active listings available.</div>
      </div>
    {% endfor %}
  </div>
</section>
{% endblock %}
